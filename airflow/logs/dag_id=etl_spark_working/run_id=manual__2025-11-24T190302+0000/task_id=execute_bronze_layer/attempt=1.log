[2025-11-24T19:04:30.373+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_spark_working.execute_bronze_layer manual__2025-11-24T19:03:02+00:00 [queued]>
[2025-11-24T19:04:30.383+0000] {taskinstance.py:1956} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_spark_working.execute_bronze_layer manual__2025-11-24T19:03:02+00:00 [queued]>
[2025-11-24T19:04:30.384+0000] {taskinstance.py:2170} INFO - Starting attempt 1 of 3
[2025-11-24T19:04:30.395+0000] {taskinstance.py:2191} INFO - Executing <Task(BashOperator): execute_bronze_layer> on 2025-11-24 19:03:02+00:00
[2025-11-24T19:04:30.400+0000] {standard_task_runner.py:60} INFO - Started process 2005 to run task
[2025-11-24T19:04:30.402+0000] {standard_task_runner.py:87} INFO - Running: ['airflow', 'tasks', 'run', 'etl_spark_working', 'execute_bronze_layer', 'manual__2025-11-24T19:03:02+00:00', '--job-id', '38', '--raw', '--subdir', 'DAGS_FOLDER/etl_spark_working_dag.py', '--cfg-path', '/tmp/tmpx93crrew']
[2025-11-24T19:04:30.404+0000] {standard_task_runner.py:88} INFO - Job 38: Subtask execute_bronze_layer
[2025-11-24T19:04:30.507+0000] {task_command.py:423} INFO - Running <TaskInstance: etl_spark_working.execute_bronze_layer manual__2025-11-24T19:03:02+00:00 [running]> on host 7934b6c65b02
[2025-11-24T19:04:30.607+0000] {taskinstance.py:2480} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='data-engineer' AIRFLOW_CTX_DAG_ID='etl_spark_working' AIRFLOW_CTX_TASK_ID='execute_bronze_layer' AIRFLOW_CTX_EXECUTION_DATE='2025-11-24T19:03:02+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-11-24T19:03:02+00:00'
[2025-11-24T19:04:30.608+0000] {subprocess.py:63} INFO - Tmp dir root location: /tmp
[2025-11-24T19:04:30.610+0000] {subprocess.py:75} INFO - Running command: ['/usr/bin/bash', '-c', '\n    echo "ü•â ========== EXECUTANDO BRONZE LAYER =========="\n    echo "üìÖ Data: $(date)"\n    echo "üîß Executor: Docker Exec"\n    \n    # Executar script via Docker\n    if docker exec spark_master python3 /opt/spark/work-dir/bronze_script.py; then\n        echo "‚úÖ Bronze Layer executado com sucesso!"\n        \n        # Aguardar para garantir que dados foram escritos\n        sleep 5\n        \n        echo "üìä Verificando dados gerados..."\n        echo "==============================================="\n    else\n        echo "‚ùå ERRO: Falha na execu√ß√£o do Bronze Layer"\n        exit 1\n    fi\n    ']
[2025-11-24T19:04:30.619+0000] {subprocess.py:86} INFO - Output:
[2025-11-24T19:04:30.621+0000] {subprocess.py:93} INFO - ü•â ========== EXECUTANDO BRONZE LAYER ==========
[2025-11-24T19:04:30.623+0000] {subprocess.py:93} INFO - üìÖ Data: Mon Nov 24 19:04:30 UTC 2025
[2025-11-24T19:04:30.623+0000] {subprocess.py:93} INFO - üîß Executor: Docker Exec
[2025-11-24T19:04:32.680+0000] {subprocess.py:93} INFO - Setting default log level to "WARN".
[2025-11-24T19:04:32.680+0000] {subprocess.py:93} INFO - To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
[2025-11-24T19:04:32.913+0000] {subprocess.py:93} INFO - 25/11/24 19:04:32 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
[2025-11-24T19:04:40.300+0000] {subprocess.py:93} INFO - 25/11/24 19:04:40 WARN SparkStringUtils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
[2025-11-24T19:04:40.431+0000] {subprocess.py:93} INFO - 25/11/24 19:04:40 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[2025-11-24T19:04:49.132+0000] {subprocess.py:93} INFO - [Stage 8:>                                                         (0 + 8) / 50][Stage 8:=========>                                                (8 + 8) / 50][Stage 8:============>                                            (11 + 8) / 50][Stage 8:======================>                                  (20 + 8) / 50][Stage 8:============================>                            (25 + 8) / 50][Stage 8:======================================>                  (34 + 8) / 50][Stage 8:============================================>            (39 + 8) / 50][Stage 8:=====================================================>   (47 + 3) / 50]                                                                                [Stage 12:>                                                         (0 + 1) / 1]25/11/24 19:04:49 WARN CSVHeaderChecker: CSV header does not conform to the schema.
[2025-11-24T19:04:49.133+0000] {subprocess.py:93} INFO -  Header: , ID PACIENTE, DATA, HOR√ÅRIO CHEGADA, DATA 2, HOR√ÅRIO CHEGADA 2, SEXO, IDADE, PESO (kg), ALTURA (m), IMC, ETAPA, CAFE√çNA, DIETA NAS √öLTIMAS 24 H, ATIVIDADE (mCi) Repouso, HORA INJE√á√ÉO Repouso, HORA IMAGEM Repouso, ATIVIDADE (mCi) Esfor√ßo, HORA INJE√á√ÉO Esfor√ßo, HORA IMAGEM Esfor√ßo, REPETIU, ETAPA REPETI√á√ÉO, MOTIVO DE REPETI√á√ÉO, PREPARO REPETI√á√ÉO, HORA REPETI√á√ÉO Repouso, HORA REPETI√á√ÉO Estress, N¬∫ REPETI√á√ÉO
[2025-11-24T19:04:49.134+0000] {subprocess.py:93} INFO -  Schema: _c0, ID PACIENTE, DATA, HOR√ÅRIO CHEGADA, DATA 2, HOR√ÅRIO CHEGADA 2, SEXO, IDADE, PESO (kg), ALTURA (m), IMC, ETAPA, CAFE√çNA, DIETA NAS √öLTIMAS 24 H, ATIVIDADE (mCi) Repouso, HORA INJE√á√ÉO Repouso, HORA IMAGEM Repouso, ATIVIDADE (mCi) Esfor√ßo, HORA INJE√á√ÉO Esfor√ßo, HORA IMAGEM Esfor√ßo, REPETIU, ETAPA REPETI√á√ÉO, MOTIVO DE REPETI√á√ÉO, PREPARO REPETI√á√ÉO, HORA REPETI√á√ÉO Repouso, HORA REPETI√á√ÉO Estress, N¬∫ REPETI√á√ÉO
[2025-11-24T19:04:49.134+0000] {subprocess.py:93} INFO - Expected: _c0 but found:
[2025-11-24T19:04:49.134+0000] {subprocess.py:93} INFO - CSV file: file:///tmp/dados_cintilografia.csv
[2025-11-24T19:04:54.570+0000] {subprocess.py:93} INFO -                                                                                 [Stage 19:===================================>                    (32 + 8) / 50]
[2025-11-24T19:04:54.573+0000] {subprocess.py:93} INFO - --- 1. BAIXANDO DADOS DA URL DO GITHUB ---
[2025-11-24T19:04:54.573+0000] {subprocess.py:93} INFO - Arquivo baixado com sucesso para: /tmp/dados_cintilografia.csv
[2025-11-24T19:04:54.574+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.574+0000] {subprocess.py:93} INFO - --- 2. LENDO E PROCESSANDO DADOS ---
[2025-11-24T19:04:54.575+0000] {subprocess.py:93} INFO - Total de registros lidos: 106
[2025-11-24T19:04:54.575+0000] {subprocess.py:93} INFO - Schema dos dados:
[2025-11-24T19:04:54.575+0000] {subprocess.py:93} INFO - root
[2025-11-24T19:04:54.575+0000] {subprocess.py:93} INFO -  |-- _c0: string (nullable = true)
[2025-11-24T19:04:54.576+0000] {subprocess.py:93} INFO -  |-- ID PACIENTE: string (nullable = true)
[2025-11-24T19:04:54.576+0000] {subprocess.py:93} INFO -  |-- DATA: string (nullable = true)
[2025-11-24T19:04:54.576+0000] {subprocess.py:93} INFO -  |-- HOR√ÅRIO CHEGADA: string (nullable = true)
[2025-11-24T19:04:54.576+0000] {subprocess.py:93} INFO -  |-- DATA 2: string (nullable = true)
[2025-11-24T19:04:54.577+0000] {subprocess.py:93} INFO -  |-- HOR√ÅRIO CHEGADA 2: timestamp (nullable = true)
[2025-11-24T19:04:54.577+0000] {subprocess.py:93} INFO -  |-- SEXO: string (nullable = true)
[2025-11-24T19:04:54.577+0000] {subprocess.py:93} INFO -  |-- IDADE: integer (nullable = true)
[2025-11-24T19:04:54.577+0000] {subprocess.py:93} INFO -  |-- PESO (kg): integer (nullable = true)
[2025-11-24T19:04:54.577+0000] {subprocess.py:93} INFO -  |-- ALTURA (m): double (nullable = true)
[2025-11-24T19:04:54.578+0000] {subprocess.py:93} INFO -  |-- IMC: double (nullable = true)
[2025-11-24T19:04:54.578+0000] {subprocess.py:93} INFO -  |-- ETAPA: string (nullable = true)
[2025-11-24T19:04:54.578+0000] {subprocess.py:93} INFO -  |-- CAFE√çNA: boolean (nullable = true)
[2025-11-24T19:04:54.579+0000] {subprocess.py:93} INFO -  |-- DIETA NAS √öLTIMAS 24 H: string (nullable = true)
[2025-11-24T19:04:54.579+0000] {subprocess.py:93} INFO -  |-- ATIVIDADE (mCi) Repouso: double (nullable = true)
[2025-11-24T19:04:54.579+0000] {subprocess.py:93} INFO -  |-- HORA INJE√á√ÉO Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.580+0000] {subprocess.py:93} INFO -  |-- HORA IMAGEM Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.580+0000] {subprocess.py:93} INFO -  |-- ATIVIDADE (mCi) Esfor√ßo: double (nullable = true)
[2025-11-24T19:04:54.580+0000] {subprocess.py:93} INFO -  |-- HORA INJE√á√ÉO Esfor√ßo: timestamp (nullable = true)
[2025-11-24T19:04:54.580+0000] {subprocess.py:93} INFO -  |-- HORA IMAGEM Esfor√ßo: timestamp (nullable = true)
[2025-11-24T19:04:54.581+0000] {subprocess.py:93} INFO -  |-- REPETIU: boolean (nullable = true)
[2025-11-24T19:04:54.581+0000] {subprocess.py:93} INFO -  |-- ETAPA REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.581+0000] {subprocess.py:93} INFO -  |-- MOTIVO DE REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.581+0000] {subprocess.py:93} INFO -  |-- PREPARO REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.582+0000] {subprocess.py:93} INFO -  |-- HORA REPETI√á√ÉO Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.582+0000] {subprocess.py:93} INFO -  |-- HORA REPETI√á√ÉO Estress: timestamp (nullable = true)
[2025-11-24T19:04:54.582+0000] {subprocess.py:93} INFO -  |-- N¬∫ REPETI√á√ÉO: integer (nullable = true)
[2025-11-24T19:04:54.582+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.583+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.583+0000] {subprocess.py:93} INFO - --- 3. AJUSTANDO NOMES DAS COLUNAS ---
[2025-11-24T19:04:54.583+0000] {subprocess.py:93} INFO - Nomes de colunas ajustados:
[2025-11-24T19:04:54.583+0000] {subprocess.py:93} INFO - root
[2025-11-24T19:04:54.584+0000] {subprocess.py:93} INFO -  |-- _c0: string (nullable = true)
[2025-11-24T19:04:54.584+0000] {subprocess.py:93} INFO -  |-- ID_PACIENTE: string (nullable = true)
[2025-11-24T19:04:54.584+0000] {subprocess.py:93} INFO -  |-- DATA: string (nullable = true)
[2025-11-24T19:04:54.584+0000] {subprocess.py:93} INFO -  |-- HOR√ÅRIO_CHEGADA: string (nullable = true)
[2025-11-24T19:04:54.585+0000] {subprocess.py:93} INFO -  |-- DATA_2: string (nullable = true)
[2025-11-24T19:04:54.585+0000] {subprocess.py:93} INFO -  |-- HOR√ÅRIO_CHEGADA_2: timestamp (nullable = true)
[2025-11-24T19:04:54.585+0000] {subprocess.py:93} INFO -  |-- SEXO: string (nullable = true)
[2025-11-24T19:04:54.585+0000] {subprocess.py:93} INFO -  |-- IDADE: integer (nullable = true)
[2025-11-24T19:04:54.586+0000] {subprocess.py:93} INFO -  |-- PESO_kg: integer (nullable = true)
[2025-11-24T19:04:54.586+0000] {subprocess.py:93} INFO -  |-- ALTURA_m: double (nullable = true)
[2025-11-24T19:04:54.586+0000] {subprocess.py:93} INFO -  |-- IMC: double (nullable = true)
[2025-11-24T19:04:54.587+0000] {subprocess.py:93} INFO -  |-- ETAPA: string (nullable = true)
[2025-11-24T19:04:54.587+0000] {subprocess.py:93} INFO -  |-- CAFE√çNA: boolean (nullable = true)
[2025-11-24T19:04:54.587+0000] {subprocess.py:93} INFO -  |-- DIETA_NAS_√öLTIMAS_24_H: string (nullable = true)
[2025-11-24T19:04:54.587+0000] {subprocess.py:93} INFO -  |-- ATIVIDADE_mCi_Repouso: double (nullable = true)
[2025-11-24T19:04:54.588+0000] {subprocess.py:93} INFO -  |-- HORA_INJE√á√ÉO_Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.588+0000] {subprocess.py:93} INFO -  |-- HORA_IMAGEM_Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.588+0000] {subprocess.py:93} INFO -  |-- ATIVIDADE_mCi_Esfor√ßo: double (nullable = true)
[2025-11-24T19:04:54.588+0000] {subprocess.py:93} INFO -  |-- HORA_INJE√á√ÉO_Esfor√ßo: timestamp (nullable = true)
[2025-11-24T19:04:54.589+0000] {subprocess.py:93} INFO -  |-- HORA_IMAGEM_Esfor√ßo: timestamp (nullable = true)
[2025-11-24T19:04:54.589+0000] {subprocess.py:93} INFO -  |-- REPETIU: boolean (nullable = true)
[2025-11-24T19:04:54.589+0000] {subprocess.py:93} INFO -  |-- ETAPA_REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.590+0000] {subprocess.py:93} INFO -  |-- MOTIVO_DE_REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.590+0000] {subprocess.py:93} INFO -  |-- PREPARO_REPETI√á√ÉO: string (nullable = true)
[2025-11-24T19:04:54.591+0000] {subprocess.py:93} INFO -  |-- HORA_REPETI√á√ÉO_Repouso: timestamp (nullable = true)
[2025-11-24T19:04:54.591+0000] {subprocess.py:93} INFO -  |-- HORA_REPETI√á√ÉO_Estress: timestamp (nullable = true)
[2025-11-24T19:04:54.591+0000] {subprocess.py:93} INFO -  |-- N_num_REPETI√á√ÉO: integer (nullable = true)
[2025-11-24T19:04:54.592+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.592+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.592+0000] {subprocess.py:93} INFO - --- 4. SALVANDO NO BRONZE LAYER ---
[2025-11-24T19:04:54.593+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.593+0000] {subprocess.py:93} INFO - --- 5. VERIFICANDO DADOS SALVOS NO BRONZE ---
[2025-11-24T19:04:54.594+0000] {subprocess.py:93} INFO - +------+-------------+-------------+---------------------+-----------------+-------------------+---------+-----+-------+--------+-----+----------+-------+---------------------------------------------------------------------+---------------------+--------------------+-------------------+---------------------+--------------------+-------------------+-------+---------------+-------------------+-----------------+----------------------+----------------------+---------------+
[2025-11-24T19:04:54.594+0000] {subprocess.py:93} INFO - |_c0   |ID_PACIENTE  |DATA         |HOR√ÅRIO_CHEGADA      |DATA_2           |HOR√ÅRIO_CHEGADA_2  |SEXO     |IDADE|PESO_kg|ALTURA_m|IMC  |ETAPA     |CAFE√çNA|DIETA_NAS_√öLTIMAS_24_H                                               |ATIVIDADE_mCi_Repouso|HORA_INJE√á√ÉO_Repouso|HORA_IMAGEM_Repouso|ATIVIDADE_mCi_Esfor√ßo|HORA_INJE√á√ÉO_Esfor√ßo|HORA_IMAGEM_Esfor√ßo|REPETIU|ETAPA_REPETI√á√ÉO|MOTIVO_DE_REPETI√á√ÉO|PREPARO_REPETI√á√ÉO|HORA_REPETI√á√ÉO_Repouso|HORA_REPETI√á√ÉO_Estress|N_num_REPETI√á√ÉO|
[2025-11-24T19:04:54.594+0000] {subprocess.py:93} INFO - +------+-------------+-------------+---------------------+-----------------+-------------------+---------+-----+-------+--------+-----+----------+-------+---------------------------------------------------------------------+---------------------+--------------------+-------------------+---------------------+--------------------+-------------------+-------+---------------+-------------------+-----------------+----------------------+----------------------+---------------+
[2025-11-24T19:04:54.595+0000] {subprocess.py:93} INFO - |TOTAL"|DELTA Repouso|DELTA Esfor√ßo|TEMPO TOTAL ATIVIDADE|TEMPO PERMANENCIA|NULL               |NULL     |NULL |NULL   |NULL    |NULL |NULL      |NULL   |NULL                                                                 |NULL                 |NULL                |NULL               |NULL                 |NULL                |NULL               |NULL   |NULL           |NULL               |NULL             |NULL                  |NULL                  |NULL           |
[2025-11-24T19:04:54.595+0000] {subprocess.py:93} INFO - |0     |235310       |2025-03-03   |2025-11-22 11:39:00  |2025-03-06       |2025-11-22 12:19:00|Masculino|35   |90     |1.69    |31.51|Incompleta|false  |P√£es, Carne Vermelha, Leite/Queijo                                   |18.0                 |2025-11-22 12:40:00 |2025-11-22 13:45:00|18.0                 |2025-11-22 12:10:00 |2025-11-22 13:04:00|false  |NULL           |NULL               |NULL             |NULL                  |NULL                  |0              |
[2025-11-24T19:04:54.595+0000] {subprocess.py:93} INFO - |1     |235301       |2025-03-05   |2025-11-22 08:04:00  |2025-03-06       |2025-11-22 08:19:00|Masculino|62   |83     |1.83    |24.78|Incompleta|false  |Biscoitos, Ovos, Leite/Queijo                                        |15.0                 |2025-11-22 08:20:00 |2025-11-22 09:44:00|15.0                 |2025-11-22 08:50:00 |2025-11-22 09:40:00|false  |NULL           |NULL               |NULL             |NULL                  |NULL                  |0              |
[2025-11-24T19:04:54.595+0000] {subprocess.py:93} INFO - |2     |223862       |2025-03-05   |2025-11-22 14:03:00  |2025-03-06       |2025-11-22 07:30:00|Feminino |71   |68     |1.61    |25.03|Incompleta|false  |P√£es, Carne Vermelha, Aves, Azeite de Oliva, Frituras                |15.0                 |2025-11-22 14:40:00 |2025-11-22 15:44:00|16.0                 |2025-11-22 08:30:00 |2025-11-22 09:21:00|false  |NULL           |NULL               |NULL             |NULL                  |NULL                  |0              |
[2025-11-24T19:04:54.596+0000] {subprocess.py:93} INFO - |3     |6549         |2025-03-05   |2025-11-22 12:30:00  |2025-03-06       |2025-11-22 09:18:00|Masculino|74   |85     |1.7     |29.41|Incompleta|false  |P√£es, Massas, Carne Vermelha, Leite/Queijo, Azeite de Oliva, Frituras|16.0                 |2025-11-22 13:12:00 |2025-11-22 14:14:00|16.0                 |2025-11-22 09:15:00 |2025-11-22 10:03:00|false  |NULL           |NULL               |NULL             |NULL                  |NULL                  |0              |
[2025-11-24T19:04:54.596+0000] {subprocess.py:93} INFO - +------+-------------+-------------+---------------------+-----------------+-------------------+---------+-----+-------+--------+-----+----------+-------+---------------------------------------------------------------------+---------------------+--------------------+-------------------+---------------------+--------------------+-------------------+-------+---------------+-------------------+-----------------+----------------------+----------------------+---------------+
[2025-11-24T19:04:54.596+0000] {subprocess.py:93} INFO - only showing top 5 rows
[2025-11-24T19:04:54.596+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.597+0000] {subprocess.py:93} INFO - Total de registros no bronze: 106
[2025-11-24T19:04:54.597+0000] {subprocess.py:93} INFO - 
[2025-11-24T19:04:54.597+0000] {subprocess.py:93} INFO - ‚úÖ Dados carregados no bronze layer com sucesso!
[2025-11-24T19:04:55.014+0000] {subprocess.py:93} INFO - ‚úÖ Bronze Layer executado com sucesso!
[2025-11-24T19:05:00.016+0000] {subprocess.py:93} INFO - üìä Verificando dados gerados...
[2025-11-24T19:05:00.017+0000] {subprocess.py:93} INFO - ===============================================
[2025-11-24T19:05:00.018+0000] {subprocess.py:97} INFO - Command exited with return code 0
[2025-11-24T19:05:00.047+0000] {taskinstance.py:1138} INFO - Marking task as SUCCESS. dag_id=etl_spark_working, task_id=execute_bronze_layer, execution_date=20251124T190302, start_date=20251124T190430, end_date=20251124T190500
[2025-11-24T19:05:00.105+0000] {local_task_job_runner.py:234} INFO - Task exited with return code 0
[2025-11-24T19:05:00.133+0000] {taskinstance.py:3280} INFO - 1 downstream tasks scheduled from follow-on schedule check
